<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register page</title>
    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="./css/style.css" rel="stylesheet">
    <!-- Icon -->
    <link rel="icon" type="image/png" href="image/icon.png">
    <style>
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="bg-light p-5 rounded mt-3 shadow-lg">
            <div class="header-container text-center">
                <a href="login.html">
                    <img src="image/logo.png" alt="Logo" class="mb-4">
                </a>
            </div>
        </div>
        <div class="bg-light p-5 rounded mt-3 shadow-lg">
            <div class="header-container text-center">
                <a>
                    <h1>ลงทะเบียน</h1>
                </a>
            </div>
        </div>
        <div class="bg-light p-5 rounded mt-3 shadow-lg">
            <form id="forme" method="post" action="register_action.php" enctype="multipart/form-data">
                <div class="form-group row">
                    <div class="col-sm-6 mb-3 mb-sm-0">
                        <label for="u_name_th" class="form-label">ชื่อ ภาษาไทย</label>
                        <input type="text" class="form-control" id="u_name_th" name="u_name_th" placeholder="ชื่อ" required>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <label for="u_surename_th" class="form-label">สกุล ภาษาไทย</label>
                        <input type="text" class="form-control" id="u_surename_th" name="u_surename_th" placeholder="สกุล" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-6 mb-3 mb-sm-0">
                        <label for="u_name_en" class="form-label">ชื่อ ภาษาอังกฤษ</label>
                        <input type="text" class="form-control" id="u_name_en" name="u_name_en" placeholder="Name" required>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <label for="u_surename_en" class="form-label">สกุล ภาษาอังกฤษ</label>
                        <input type="text" class="form-control" id="u_surename_en" name="u_surename_en" placeholder="Surename" required>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-sm-6 mb-3 mb-sm-0">
                        <label for="u_rank" class="form-label">ยศ</label>
                        <input type="text" class="form-control" id="u_rank" name="u_rank" placeholder="ยศ" required>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <label for="u_position" class="form-label">ตำแหน่ง</label>
                        <input type="text" class="form-control" id="u_position" name="u_position" placeholder="ตำแหน่ง" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="u_idcard" class="form-label">เลขบัตรราชการ</label>
                    <input type="text" class="form-control" id="u_idcard" name="u_idcard" placeholder="Idcard" required>
                </div>
                <div class="mb-3">
                    <label for="u_email" class="form-label">E-mail</label>
                    <input type="email" class="form-control" id="u_email" name="u_email" placeholder="E-mail" required>
                </div>
                <div class="mb-3">
                    <label for="u_username" class="form-label">Username</label>
                    <input type="text" readonly class="form-control" id="u_username" name="u_username" value="" placeholder="" required>
                </div>
                <div class="mb-3">
                    <label for="u_password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="u_password" name="u_password" placeholder="Password" required>
                    <small id="passwordHelp" class="form-text text-muted">ต้องมีความยาวอย่างน้อย 6 ตัวอักษร ประกอบด้วยตัวเลขอย่างน้อย 1 ตัวและตัวอักษรใหญ่อย่างน้อย 1 ตัว</small>
                </div>
                <div class="mb-3">
                    <label for="u_password_confirm" class="form-label">confirm-Password</label>
                    <input type="password" class="form-control" id="u_password_confirm" name="u_password_confirm" placeholder="Confirm -Password" required>
                </div>
                <div class="mb-3">
                    <input type="hidden" class="form-control" id="u_level" name="u_level" value="user">
                </div>
                <div class="mb-3">
                    <label for="u_img" class="form-label">Upload รูปบัตรราชการ</label>
                    <input type="file" class="form-control" id="u_img" name="u_img" placeholder="Upload รูปบัตรราชการ" required>
                </div>
                <div class="mb-3 preview-container">
                    <img id="preview-img" src="#" alt="Preview Image" style="max-width: 200px; display: none;">
                </div>
                <button class="w-100 btn btn-lg btn-primary shadow-lg" type="submit">ลงทะเบียน</button>
                <a href="login.html" class="w-100 btn btn-lg btn-danger mt-3 shadow-lg">ยกเลิก</a>
            </form>
        </div>
        <footer class="footer mt-5 bg-white text-dark py-3 rounded shadow">
            <div class="container text-center">
                <span>© Immigration Bureau: สำนักงานตรวจคนเข้าเมือง</span>
            </div>
        </footer>
    </div>

    <p id="result"></p>

    <script>
        const name_th = document.getElementById('u_name_th');
        const surename_th = document.getElementById('u_surename_th');
        const name_en = document.getElementById('u_name_en');
        const surename_en = document.getElementById('u_surename_en');
        const u_username = document.getElementById('u_username');
        const idcard = document.getElementById('u_idcard');

        function generateUsername() {
            const str1 = name_en.value;
            const str2 = surename_en.value;
            const str2trim = str2.substring(0, 2);
            const concatenatedString = str1 + "." + str2trim;
            const concatenatedStringlowercase = concatenatedString.toLowerCase();

            u_username.value = concatenatedStringlowercase;
        }

        function validateThaiInput(input) {
            const regex = /^[ก-๏\s]+$/;
            if (!regex.test(input.value)) {
                input.setCustomValidity('กรุณากรอกเฉพาะตัวอักษรภาษาไทย');
            } else {
                input.setCustomValidity('');
            }
        }

        function validateEnglishInput(input) {
            const regex = /^[A-Za-z\s]*$/;
            if (!regex.test(input.value)) {
                input.setCustomValidity('กรุณากรอกเฉพาะตัวอักษรภาษาอังกฤษ');
            } else {
                input.setCustomValidity('');
            }
        }

        function validateNumericInput(input) {
            const regex = /^[0-9]*$/;
            if (!regex.test(input.value)) {
                input.setCustomValidity('กรุณากรอกเฉพาะตัวเลข');
            } else {
                input.setCustomValidity('');
            }
        }

        name_th.addEventListener('input', () => {
            validateThaiInput(name_th);
        });

        surename_th.addEventListener('input', () => {
            validateThaiInput(surename_th);
        });

        name_en.addEventListener('input', () => {
            generateUsername();
            validateEnglishInput(name_en);
        });

        surename_en.addEventListener('input', () => {
            generateUsername();
            validateEnglishInput(surename_en);
        });

        idcard.addEventListener('input', () => {
            validateNumericInput(idcard);
        });

        const fileInput = document.getElementById('u_img');
        const previewImg = document.getElementById('preview-img');

        fileInput.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.addEventListener('load', function () {
                    previewImg.src = reader.result;
                    previewImg.style.display = 'block';
                });
                reader.readAsDataURL(file);
            } else {
                previewImg.src = '#';
                previewImg.style.display = 'none';
            }
        });

        const passwordInput = document.getElementById('u_password');
        const confirmPasswordInput = document.getElementById('u_password_confirm');

        function checkPasswordMatch() {
            const passwordError = validatePassword(passwordInput.value);
            if (passwordError) {
                passwordInput.setCustomValidity(passwordError);
            } else {
                passwordInput.setCustomValidity('');
                if (passwordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.setCustomValidity('รหัสผ่านไม่ตรงกัน');
                } else {
                    confirmPasswordInput.setCustomValidity('');
                }
            }
        }

        passwordInput.addEventListener('input', checkPasswordMatch);
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);

        function validatePassword(password) {
            if (password.length < 6) {
                return "รหัสผ่านต้องมีความยาวอย่างน้อย 6 ตัวอักษร";
            }
            if (!/\d/.test(password)) {
                return "รหัสผ่านต้องประกอบด้วยตัวเลขอย่างน้อย 1 ตัว";
            }
            if (!/[a-z]/.test(password)) {
                return "รหัสผ่านต้องประกอบด้วยตัวอักษรพิมพ์เล็กอย่างน้อย 1 ตัว";
            }
            if (!/[A-Z]/.test(password)) {
                return "รหัสผ่านต้องประกอบด้วยตัวอักษรพิมพ์ใหญ่อย่างน้อย 1 ตัว";
            }
            return "";
        }
    </script>
</body>

</html>
